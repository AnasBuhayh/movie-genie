schema: '2.0'
stages:
  ingest:
    cmd: .venv/bin/python scripts/ingest_data.py --config configs/data.yaml
    deps:
    - path: configs/data.yaml
      hash: md5
      md5: 049f1d287ada87fb7b57774f313957ad
      size: 372
    - path: scripts/ingest_data.py
      hash: md5
      md5: fa6b92d8fee7eb471cc0c86281f578af
      size: 1625
    outs:
    - path: data/raw/movies.csv
      hash: md5
      md5: ed94fab72b62442ef8150d9446e000d6
      size: 494431
    - path: data/raw/ratings.csv
      hash: md5
      md5: 325a6f09399d1c45671f187505e1a100
      size: 2483723
  sequential_processing:
    cmd: .venv/bin/python scripts/process_sequential_data.py --config 
      configs/data.yaml
    deps:
    - path: configs/data.yaml
      hash: md5
      md5: 049f1d287ada87fb7b57774f313957ad
      size: 372
    - path: data/raw/movies.csv
      hash: md5
      md5: ed94fab72b62442ef8150d9446e000d6
      size: 494431
    - path: data/raw/ratings.csv
      hash: md5
      md5: 325a6f09399d1c45671f187505e1a100
      size: 2483723
    - path: scripts/process_sequential_data.py
      hash: md5
      md5: 62707d633feec8725d795617cac80f0d
      size: 1622
    outs:
    - path: data/processed/sequences_with_metadata.parquet
      hash: md5
      md5: ba5ff685cb977e41cdb6bbeb67a1cc63
      size: 1187276
  content_features:
    cmd: .venv/bin/python scripts/extract_content_features.py --config 
      configs/data.yaml
    deps:
    - path: configs/data.yaml
      hash: md5
      md5: 049f1d287ada87fb7b57774f313957ad
      size: 372
    - path: data/raw/movies.csv
      hash: md5
      md5: ed94fab72b62442ef8150d9446e000d6
      size: 494431
    - path: scripts/extract_content_features.py
      hash: md5
      md5: 9bf07ec8e71704864dface24cd5b5f71
      size: 3484
    params:
      configs/data.yaml:
        processing.embedding_model: sentence-transformers/all-MiniLM-L6-v2
    outs:
    - path: data/processed/content_features.parquet
      hash: md5
      md5: 39509f00454583bb2e7393253e4090ed
      size: 30315719
  two_tower_training:
    cmd: ".venv/bin/python scripts/train_two_tower.py --config configs/two_tower.yaml
      --mlflow-config configs/mlflow.yaml\n"
    deps:
    - path: configs/mlflow.yaml
      hash: md5
      md5: 691288686091d1ef20bfb9c7b425d9b2
      size: 2488
    - path: configs/two_tower.yaml
      hash: md5
      md5: e515f77b4ed6bb5b109bf1c867346ad7
      size: 965
    - path: data/processed/content_features.parquet
      hash: md5
      md5: 39509f00454583bb2e7393253e4090ed
      size: 30315719
    - path: data/processed/sequences_with_metadata.parquet
      hash: md5
      md5: ba5ff685cb977e41cdb6bbeb67a1cc63
      size: 1187276
    - path: movie_genie/retrieval/two_tower_model.py
      hash: md5
      md5: 61c51c4f50b4d078e856da0700222696
      size: 71338
    - path: scripts/train_two_tower.py
      hash: md5
      md5: 9ad1b5d3a3eb04ea8904ea5409cb315b
      size: 20054
    params:
      configs/two_tower.yaml:
        model.embedding_dim: 128
        model.item_hidden_dims:
        - 256
        - 128
        model.user_hidden_dims:
        - 128
        - 64
        training.batch_size: 256
        training.num_epochs: 50
    outs:
    - path: models/two_tower
      hash: md5
      md5: 8a955de5b841b49cef47ec3ae3784d06.dir
      size: 3835964
      nfiles: 3
  bert4rec_training:
    cmd: ".venv/bin/python scripts/train_bert4rec.py --config configs/bert4rec.yaml
      --mlflow-config configs/mlflow.yaml\n"
    deps:
    - path: configs/bert4rec.yaml
      hash: md5
      md5: 8b9a4896b7dacf833de86ecf29d4685c
      size: 2728
    - path: configs/mlflow.yaml
      hash: md5
      md5: 691288686091d1ef20bfb9c7b425d9b2
      size: 2488
    - path: data/processed/content_features.parquet
      hash: md5
      md5: 39509f00454583bb2e7393253e4090ed
      size: 30315719
    - path: data/processed/sequences_with_metadata.parquet
      hash: md5
      md5: ba5ff685cb977e41cdb6bbeb67a1cc63
      size: 1187276
    - path: movie_genie/ranking/bert4rec_model.py
      hash: md5
      md5: a6ff8a8b84c16f870ead23acd464dbef
      size: 30849
    - path: scripts/train_bert4rec.py
      hash: md5
      md5: 42045f78073f8e818cb1cb0f5e39a0e5
      size: 28148
    params:
      configs/bert4rec.yaml:
        model.hidden_dim: 256
        model.num_heads: 8
        model.num_layers: 4
        training.batch_size: 64
        training.num_epochs: 100
    outs:
    - path: models/bert4rec
      hash: md5
      md5: cdeb234569748f3f82d7493ba5315fe1.dir
      size: 23722738
      nfiles: 4
  integrated_evaluation:
    cmd: .venv/bin/python scripts/evaluate_integrated_system.py
    deps:
    - path: data/processed/content_features.parquet
      hash: md5
      md5: 39509f00454583bb2e7393253e4090ed
      size: 30315719
    - path: data/processed/sequences_with_metadata.parquet
      hash: md5
      md5: ba5ff685cb977e41cdb6bbeb67a1cc63
      size: 1187276
    - path: models/bert4rec/
      hash: md5
      md5: cdeb234569748f3f82d7493ba5315fe1.dir
      size: 23722738
      nfiles: 4
    - path: models/two_tower/
      hash: md5
      md5: 8a955de5b841b49cef47ec3ae3784d06.dir
      size: 3835964
      nfiles: 3
    - path: scripts/evaluate_integrated_system.py
      hash: md5
      md5: 600036725b25777529c0ce47155a6f2c
      size: 39695
    outs:
    - path: results/integrated_system_evaluation.json
      hash: md5
      md5: 3936cea1cf08989806a2f787b95c79e8
      size: 34173138
    - path: results/key_metrics.json
      hash: md5
      md5: 13c826b093c53665681b81baa0019b8c
      size: 1151
  frontend_build:
    cmd: "cd movie_genie/frontend && npm run build && cp ../backend/dist/index.html
      ../backend/templates/ && mkdir -p ../backend/static && cp -r ../backend/dist/css
      ../backend/static/ && cp -r ../backend/dist/js ../backend/static/ && [ -d ../backend/dist/img
      ] && cp -r ../backend/dist/img ../backend/static/ || true && [ -d ../backend/dist/assets
      ] && cp -r ../backend/dist/assets ../backend/static/ || true\n"
    deps:
    - path: movie_genie/frontend/index.html
      hash: md5
      md5: b9158ed247cd74b7ee76891655a95981
      size: 1244
    - path: movie_genie/frontend/package.json
      hash: md5
      md5: 577cb43a0511bf77543c29beba9c0453
      size: 2758
    - path: movie_genie/frontend/src/
      hash: md5
      md5: 7624d1c5a98e46b73c2599f6d868824e.dir
      size: 425737
      nfiles: 81
    - path: movie_genie/frontend/tailwind.config.ts
      hash: md5
      md5: 93be9dc915ab46eb00ba50615b111fd6
      size: 2956
    - path: movie_genie/frontend/vite.config.ts
      hash: md5
      md5: fdc5ec406ef1f254a927e740d30b1d1f
      size: 1259
    outs:
    - path: movie_genie/backend/static/
      hash: md5
      md5: b24dbf84ef57a49bff3c9a9cd744539c.dir
      size: 856002
      nfiles: 2
    - path: movie_genie/backend/templates/index.html
      hash: md5
      md5: 77f597ca86ce274d3b2acd47d7879f3d
      size: 1347
  backend_server:
    cmd: FLASK_PORT=5001 python scripts/start_server.py
    deps:
    - path: configs/semantic_search.yaml
      hash: md5
      md5: d9f7f2d4171d5625ee030340199844a0
      size: 666
    - path: data/processed/content_features.parquet
      hash: md5
      md5: 368c203e51530b749b1d8a2156b39ebf
      size: 53312377
    - path: data/processed/sequences_with_metadata.parquet
      hash: md5
      md5: ba5ff685cb977e41cdb6bbeb67a1cc63
      size: 1187276
    - path: models/bert4rec/
      hash: md5
      md5: 106288facde1a3c9565cb620421390a8.dir
      size: 23722178
      nfiles: 4
    - path: models/two_tower/
      hash: md5
      md5: 8a955de5b841b49cef47ec3ae3784d06.dir
      size: 3835964
      nfiles: 3
    - path: movie_genie/backend/app.py
      hash: md5
      md5: 2a3f654cff0640e444399fa03d7e4b9f
      size: 1988
    - path: movie_genie/backend/app/
      hash: md5
      md5: 843c0ff18e614708692964cf6e497e6c.dir
      size: 188455
      nfiles: 32
    - path: movie_genie/backend/config.py
      hash: md5
      md5: d0032220660b45a8bd52043de7471ed9
      size: 3432
    - path: movie_genie/backend/static/
      hash: md5
      md5: 909cf29e5d7d794107fe5c05f6af797e.dir
      size: 396161
      nfiles: 2
    - path: movie_genie/backend/templates/index.html
      hash: md5
      md5: 96a733982ae8edda1ded915c9f75c915
      size: 1347
